cscope 15 $HOME/code/cplusplus/hdp-zl               0000032881
	@corpus.cc

16 
	~<as£¹.h
>

17 
	~<g¦/g¦_³rmutiÚ.h
>

18 
	~<m©h.h
>

20 
	~<f¡»am
>

21 
	~<io¡»am
>

22 
	~<s¡»am
>

24 
	~"cÜpus.h
"

27 
	#BUF_SIZE
 10000

	)

29 
Çme¥aû
 
	ghdp
 {

35 
	gCÜpus
::
CÜpus
()

36 : 
gamma_
(0.0),

37 
®pha_
(0.0),

38 
wÜd_no_
(0),

39 
wÜd_tÙ®_
(0) {

42 
	gCÜpus
::
CÜpus
(
gamma
, 
®pha
)

43 : 
gamma_
(
gamma
),

44 
®pha_
(
®pha
),

45 
wÜd_no_
(0),

46 
wÜd_tÙ®_
(0) {

54 
	gCÜpusUts
::
R—dCÜpus
(

55 cÚ¡ 
¡d
::
¡ršg
& 
f’ame
,

56 
CÜpus
* 
cÜpus
) {

58 
if¡»am
 
šfe
(
f’ame
.
c_¡r
());

59 
	gbuf
[
BUF_SIZE
];

61 
	gdoc_no
 = 0;

62 
	gwÜd_no
 = 0;

63 
	gtÙ®_wÜd_couÁ
 = 0;

64 
	gwÜds
;

66 
	gšfe
.
g‘lše
(
buf
, 
BUF_SIZE
)) {

67 
i¡ršg¡»am
 
s_lše
(
buf
);

69 
	gwÜd_couÁ_pos
 = 0;

70 
Docum’t
 
docum’t
(
doc_no
);

71 
	gs_lše
.
g‘lše
(
buf
, 
BUF_SIZE
, ' ')) {

72 ià(
	gwÜd_couÁ_pos
 == 0) {

73 
wÜds
 = 
©oi
(
buf
);

75 
	gwÜd_id
, 
	gwÜd_couÁ
;

76 
i¡ršg¡»am
 
s_wÜd_couÁ
(
buf
);

77 
	g¡d
::
¡ršg
 
¡r
;

78 
g‘lše
(
s_wÜd_couÁ
, 
¡r
, ':');

79 
	gwÜd_id
 = 
©oi
(
¡r
.
c_¡r
());

80 
g‘lše
(
s_wÜd_couÁ
, 
¡r
, ':');

81 
	gwÜd_couÁ
 = 
©oi
(
¡r
.
c_¡r
());

82 
	gtÙ®_wÜd_couÁ
 +ğ
wÜd_couÁ
;

83 
	gi
 = 0; i < 
	gwÜd_couÁ
; i++) {

84 
	gdocum’t
.
addWÜd
(
wÜd_id
);

86 ià(
	gwÜd_id
 >ğ
wÜd_no
) {

87 
wÜd_no
 = 
wÜd_id
 + 1;

90 
	gwÜd_couÁ_pos
++;

92 
	gcÜpus
->
addDocum’t
(
docum’t
);

93 
	gdoc_no
 += 1;

96 
	gšfe
.
şo£
();

98 
	gcÜpus
->
£tWÜdNo
(
wÜd_no
);

99 
	gcÜpus
->
£tWÜdTÙ®
(
tÙ®_wÜd_couÁ
);

100 
	gcout
 << "Numb” oàdocum’t š cÜpus: " << 
	gdoc_no
 << 
	g’dl
;

101 
	gcout
 << "Numb” oàdi¡šù wÜd š cÜpus: " << 
	gwÜd_no
 << 
	g’dl
;

102 
	gcout
 << "Numb” oàwÜd š cÜpus: " << 
	gtÙ®_wÜd_couÁ
 << 
	g’dl
;

107 
	gCÜpusUts
::
P”mu‹Docum’ts
(
CÜpus
* 
cÜpus
) {

108 
size
 = 
cÜpus
->
g‘Docum’ts
();

109 
	gveùÜ
<
	gDocum’t
> 
	g³rmu‹d_docum’ts
;

114 
g¦_³rmutiÚ
* 
	g³rm
 = 
g¦_³rmutiÚ_ÿÎoc
(
size
);

115 
	gUts
::
Shufæe
(
³rm
, 
size
);

116 
	g³rm_size
 = 
³rm
->
size
;

117 
as£¹
(
size
 =ğ
³rm_size
);

119 
	gi
 = 0; i < 
	g³rm_size
; i++) {

120 
	g³rmu‹d_docum’ts
.
push_back
(*
cÜpus
->
g‘MubËDocum’t
(
³rm
->
d©a
[
i
]));

123 
	gcÜpus
->
£tDocum’ts
(
³rmu‹d_docum’ts
);

125 
g¦_³rmutiÚ_ä“
(
³rm
);

128 
	gCÜpusUts
::
AÍhaScÜe
(
CÜpus
* 
cÜpus
) {

129 
®pha
 = 
cÜpus
->
g‘AÍha
();

130 
	gdoc_no
 = 
cÜpus
->
g‘Docum’ts
();

131 
	gscÜe
 = 0.0;

132 
	gi
 = 0; i < 
	gdoc_no
; i++) {

133 
Docum’t
* 
	gdocum’t
 = 
cÜpus
->
g‘MubËDocum’t
(
i
);

134 
	gscÜe
 +ğ
Docum’tUts
::
AÍhaScÜe
(
docum’t
, 
®pha
);

137  
	gscÜe
;

	@corpus.h

1 #iâdeà
CORPUS_H_


2 
	#CORPUS_H_


	)

4 
	~<¡ršg
>

6 
	~"docum’t.h
"

7 
	~"uts.h
"

9 
Çme¥aû
 
	ghdp
 {

13 şas 
	cCÜpus
 {

14 
	gpublic
:

15 
CÜpus
();

16 
CÜpus
(
gamma
, 
®pha
);

18 
£tWÜdNo
(
wÜd_no
è{ 
	gwÜd_no_
 = word_no; }

19 
g‘WÜdNo
(ècÚ¡ {  
	gwÜd_no_
; }

21 
addDocum’t
(cÚ¡ 
Docum’t
& 
docum’t
) {

22 
	gdocum’ts_
.
push_back
(
docum’t
);

24 
g‘Docum’ts
(ècÚ¡ {  
	gdocum’ts_
.
size
(); }

25 
Docum’t
* 
g‘MubËDocum’t
(
i
è{  &
	gdocum’ts_
.
©
(i); }

26 
£tDocum’ts
(cÚ¡ 
veùÜ
<
Docum’t
>& 
docum’ts
) {

27 
	gdocum’ts_
 = 
docum’ts
;

30 
g‘WÜdTÙ®
(ècÚ¡ {  
	gwÜd_tÙ®_
; }

31 
£tWÜdTÙ®
(
wÜd_tÙ®
è{ 
	gwÜd_tÙ®_
 = word_total; }

33 
£tGamma
(
gamma
è{ 
	ggamma_
 = gamma; }

34 
g‘Gamma
(ècÚ¡ {  
	ggamma_
; }

36 
£tAÍha
(
®pha
è{ 
	g®pha_
 =‡lpha; }

37 
g‘AÍha
(ècÚ¡ {  
	g®pha_
; }

38 
	g´iv©e
:

41 
gamma_
;

45 
	g®pha_
;

48 
	gwÜd_no_
;

51 
	gwÜd_tÙ®_
;

54 
	gveùÜ
<
	gDocum’t
> 
	gdocum’ts_
;

58 şas 
	cCÜpusUts
 {

59 
	gpublic
:

61 
R—dCÜpus
(

62 cÚ¡ 
¡d
::
¡ršg
& 
f’ame
,

63 
CÜpus
* 
cÜpus
);

67 
P”mu‹Docum’ts
(
CÜpus
* 
cÜpus
);

70 
AÍhaScÜe
(
CÜpus
* 
cÜpus
);

	@document.cc

1 
	~<m©h.h
>

2 
	~<as£¹.h
>

4 
	~"docum’t.h
"

5 
	~"uts.h
"

6 
	~"tİic.h
"

8 
Çme¥aû
 
	ghdp
 {

14 
	gWÜd
::
WÜd
(
id
)

15 : 
id_
(
id
) {

19 
WÜd
::~Word() {}

25 
WÜdUts
::
Upd©eTabËFromWÜd
(
WÜd
* 
wÜd
,

26 
upd©e
) {

27 
TabË
* 
	gbË
 = 
wÜd
->
g‘MubËTabË
();

28 
	gbË
->
šcWÜdCouÁ
(
upd©e
);

29 
	gbË
->
upd©eM­WÜdCouÁ
(
wÜd
->
g‘Id
(), 
upd©e
);

32 
	gTabËUts
::
Upd©eTİicFromTabË
(
bË
, 
wÜd
->
g‘Id
(), 
upd©e
);

39 
	gTabË
::
TabË
()

40 : 
wÜd_couÁ_
(0) {

41 
tİic_
 = 
NULL
;

44 
	gTabË
::
TabË
(
wÜd_couÁ
)

45 : 
wÜd_couÁ_
(
wÜd_couÁ
) {

46 
tİic_
 = 
NULL
;

51 
	gTabË
::
g‘CouÁById
(
wÜd_id
) {

52 autØ
™
 = 
m­_wÜd_couÁ_
.
fšd
(
wÜd_id
);

53 ià(
	g™
 =ğ
m­_wÜd_couÁ_
.
’d
()) {

56  
	gm­_wÜd_couÁ_
[
wÜd_id
];

60 
	gTabË
::
upd©eM­WÜdCouÁ
(
wÜd_id
, 
upd©e
) {

61 autØ
	g™
 = 
m­_wÜd_couÁ_
.
fšd
(
wÜd_id
);

62 ià(
	g™
 =ğ
m­_wÜd_couÁ_
.
’d
()) {

63 
m­_wÜd_couÁ_
[
wÜd_id
] = 
upd©e
;

65 
	gm­_wÜd_couÁ_
[
wÜd_id
] +ğ
upd©e
;

67 
as£¹
(
m­_wÜd_couÁ_
[
wÜd_id
] >= 0);

68 ià(
	gm­_wÜd_couÁ_
[
wÜd_id
] == 0) {

69 
m­_wÜd_couÁ_
.
”a£
(
wÜd_id
);

79 
	gTabËUts
::
G‘WÜdsAndCouÁs
(
TabË
* 
bË
,

80 
veùÜ
<>& 
wÜd_ids
,

81 
veùÜ
<>& 
couÁs
) {

82 
	gunÜd”ed_m­
<, >& 
	gm
 = 
bË
->
g‘M­WÜdCouÁ
();

83 
	gsize
 = 
m
.
size
();

85 
	gwÜd_ids
.
»£rve
(
size
);

86 
	gcouÁs
.
»£rve
(
size
);

88 autØ
	gp
 : 
m
) {

89 
wÜd_ids
.
push_back
(
p
.
fœ¡
);

90 
	gcouÁs
.
push_back
(
p
.
£cÚd
);

94 
	gTabËUts
::
Upd©eTİicFromTabË
(
TabË
* 
bË
,

95 
wÜd_id
,

96 
upd©e
) {

97 
Tİic
* 
	gtİic
 = 
bË
->
g‘MubËTİic
();

98 
	gtİic
->
upd©eWÜdCouÁs
(
wÜd_id
, 
upd©e
);

101 
	gTabËUts
::
Upd©eTİicFromTabË
(
TabË
* 
bË
,

102 
veùÜ
<>& 
wÜd_ids
,

103 
veùÜ
<>& 
couÁs
,

104 
upd©e
) {

106 
	gsize
 = 
wÜd_ids
.
size
();

108 
	gi
 = 0; i < 
	gsize
; i++) {

109 
	gwÜd_id
 = 
wÜd_ids
[
i
];

110 
Upd©eTİicFromTabË
(
bË
, 
wÜd_id
, 
upd©e
 * 
couÁs
[word_id]);

113 
	gbË
->
g‘MubËTİic
()->
šcTabËCouÁ
(
upd©e
);

116 
	gTabËUts
::
Sam¶eTİicFÜTabË
(
TabË
* 
bË
,

117 
gamma
) {

118 
	gAÎTİics
& 
	g®l_tİics
 = 
AÎTİics
::
G‘In¡ªû
();

119 
	gtİics
 = 
®l_tİics
.
g‘Tİics
();

121 
	gveùÜ
<> 
	gwÜd_ids
;

122 
	gveùÜ
<> 
	gcouÁs
;

123 
	gTabËUts
::
G‘WÜdsAndCouÁs
(
bË
, 
wÜd_ids
, 
couÁs
);

125 
as£¹
(
tİics
 >= 1);

126 
	gcÜpus_wÜd_no
 = 
®l_tİics
.
g‘MubËTİic
(0)->
g‘CÜpusWÜdNo
();

127 
	g®l_tİics
.
addNewTİic
(
cÜpus_wÜd_no
);

129 
	gveùÜ
<> 
log_´
(
tİics
 + 1, 0.0);

130 
	gi
 = 0; i < 
	gtİics
; i++) {

131 
Tİic
* 
	gtİic
 = 
®l_tİics
.
g‘MubËTİic
(
i
);

132 ià(
	gbË
->
g‘MubËTİic
(è!ğ
tİic
) {

133 
log_´
[
i
] = 
TİicTabËUts
::
LogGammaR©io
(
bË
, 
tİic
,

134 
wÜd_ids
, 
couÁs
) +

135 
log
(
tİic
->
g‘TabËCouÁ
());

137 
	glog_´
[
i
] = 
TİicTabËUts
::
LogGammaR©io
(
bË
, 
tİic
,

138 
wÜd_ids
, 
couÁs
) +

139 
log
(
tİic
->
g‘TabËCouÁ
() - 1);

141 
Tİic
* 
	gÃw_tİic
 = 
®l_tİics
.
g‘MubËTİic
(
tİics
);

142 
	glog_´
[
tİics
] = 
log
(
gamma
è+ 
TİicTabËUts
::
LogGammaR©io
(
bË
, 
Ãw_tİic
,

143 
wÜd_ids
, 
couÁs
);

147 
	g§m¶e_tİic
 = 
Uts
::
Sam¶eFromLogPr
(
log_´
);

148 
Tİic
* 
	gŞd_tİic
 = 
bË
->
g‘MubËTİic
();

149 
Tİic
* 
	gÃw_tİic
 = 
®l_tİics
.
g‘MubËTİic
(
§m¶e_tİic
);

151 ià(
	gŞd_tİic
 !ğ
Ãw_tİic
) {

152 
bË
->
£tTİic
(
Ãw_tİic
);

153 
	gTabËUts
::
Upd©eTİicFromTabË
(
bË
, 
wÜd_ids
, 
couÁs
, 1);

156 ià(
	g§m¶e_tİic
 =ğ
tİics
) {

157 
®l_tİics
.
»moveLa¡Tİic
();

165 
	gDocum’t
::
Docum’t
(
id
)

166 : 
id_
(
id
) {

169 
Docum’t
::~Document() {

170 
size
 = 
g‘TabËs
();

171 
	gi
 = 0; i < 
	gsize
; i++) {

172 ià(
	gbËs_
[
i
] !ğ
NULL
) {

173 
d–‘e
 
bËs_
[
i
];

178 
	gDocum’t
::
»moveTabË
(
pos
) {

179 
TabË
* 
bË
 = 
bËs_
[
pos
];

180 
as£¹
(
bË
->
g‘WÜdCouÁ
() == 0);

181 
as£¹
(
bË
->
g‘M­WÜdCouÁ
().
size
() == 0);

182 
Tİic
* 
	gtİic
 = 
bË
->
g‘MubËTİic
();

183 
	gtİic
->
šcTabËCouÁ
(-1);

184 
	gtİic
 = 
NULL
;

185 autØ
	g™
 = 
bËs_
.
begš
(è+ 
pos
;

186 
d–‘e
 *
	g™
;

187 *
	g™
 = 
NULL
;

188 
	gbËs_
.
”a£
(
™
);

195 
	gDocum’tUts
::
AÍhaScÜe
(
Docum’t
* 
docum’t
,

196 
®pha
) {

197 
	gbËs
 = 
docum’t
->
g‘TabËs
();

198 
	gwÜds
 = 
docum’t
->
g‘WÜds
();

199 
	gscÜe
 = 0.0;

200 
	gscÜe
 +ğ
bËs
 * 
log
(
®pha
) +

201 
g¦_sf_Êgamma
(
®pha
) -

202 
g¦_sf_Êgamma
(
wÜds
 + 
®pha
);

203 
	gi
 = 0; i < 
	gbËs
; i++) {

204 
TabË
* 
	gbË
 = 
docum’t
->
g‘MubËTabË
(
i
);

205 
	gscÜe
 +ğ
g¦_sf_Êgamma
(
bË
->
g‘WÜdCouÁ
());

207  
	gscÜe
;

210 
	gDocum’tUts
::
Com·ùTabËs
(
Docum’t
* 
docum’t
) {

211 
bËs
 = 
docum’t
->
g‘TabËs
();

212 
	gi
 = 
bËs
 - 1; i >=0 ; --i) {

213 ià(
	gdocum’t
->
g‘MubËTabË
(
i
)->
g‘WÜdCouÁ
() == 0) {

214 
docum’t
->
»moveTabË
(
i
);

219 
	gDocum’tUts
::
Sam¶eTabËs
(
Docum’t
* 
docum’t
,

220 
³rmu‹_wÜds
,

221 
boŞ
 
»move
,

222 
®pha
,

223 
gamma
) {

224 ià(
	g³rmu‹_wÜds
 == 1) {

225 
P”mu‹WÜds
(
docum’t
);

228 
	gwÜds
 = 
docum’t
->
g‘WÜds
();

229 
	gi
 = 0; i < 
	gwÜds
; i++) {

230 
WÜd
* 
	gwÜd
 = 
docum’t
->
g‘MubËWÜd
(
i
);

231 
Sam¶eTabËFÜWÜd
(
docum’t
, 
wÜd
, 
»move
, 
®pha
, 
gamma
);

235 
	gDocum’tUts
::
Sam¶eTabËFÜWÜd
(
Docum’t
* 
docum’t
,

236 
WÜd
* 
wÜd
,

237 
boŞ
 
»move
,

238 
®pha
,

239 
gamma
,

240 
cÜpus_wÜd_no
) {

241 ià(
	g»move
è
	gWÜdUts
::
Upd©eTabËFromWÜd
(
wÜd
, -1);

243 
	gbËs
 = 
docum’t
->
g‘TabËs
();

244 
	gveùÜ
<> 
log_´
(
bËs
 + 1, 
log
(0));

246 
	gAÎTİics
& 
	g®l_tİics
 = 
AÎTİics
::
G‘In¡ªû
();

247 
	gtİics
 = 
®l_tİics
.
g‘Tİics
();

248 
as£¹
(
tİics
 >= 0);

251 
	gwÜd_id
 = 
wÜd
->
g‘Id
();

255 
	gveùÜ
<> 
log_´_tİic
(
tİics
 + 1 , 0.0);

258 
	gveùÜ
<> 
f
(
tİics
+1, 
log
(0));

259 
	gf_Ãw
 = 
log
(
gamma
 / 
cÜpus_wÜd_no
);

261 
	glog_´_tİic
[
tİics
] = 
f_Ãw
;

263 
	gtÙ®_bËs
 = 0;

264 
	gunÜd”ed_m­
<
	gTİic
*, > 
	gtİic_to_k
;

266 
	gk
 = 0; k < 
	gtİics
; k++) {

267 
Tİic
* 
	gtİic
 = 
®l_tİics
.
g‘MubËTİic
(
k
);

268 
	gtİic_to_k
[
tİic
] = 
k
;

269 
	gf
[
k
] = 
tİic
->
g‘LogWÜdPr
(
wÜd_id
);

270 
	gbË_couÁ
 = 
tİic
->
g‘TabËCouÁ
();

271 
	gtÙ®_bËs
 +ğ
bË_couÁ
;

272 
	glog_´_tİic
[
k
] = 
f
[k] + 
log
(
bË_couÁ
);

273 
	gf_Ãw
 = 
Uts
::
LogSum
(
f_Ãw
,

274 
f
[
k
] + 
log
(
bË_couÁ
));

276 
	gf_Ãw
 = 
f_Ãw
 - 
log
(
tÙ®_bËs
 + 
gamma
);

277 
	gf
[
tİics
] = 
f_Ãw
;

279 
	gt
 = 0; < 
	gbËs
;++) {

280 
TabË
* 
	gbË
 = 
docum’t
->
g‘MubËTabË
(
t
);

281 
	gbË_wÜd_couÁ
 = 
bË
->
g‘WÜdCouÁ
();

282 
	glog_wÜd_couÁ
 = 
log
(
bË_wÜd_couÁ
);

284 
Tİic
* 
	gtİic
 = 
bË
->
g‘MubËTİic
();

285 
	gk
 = 
tİic_to_k
[
tİic
];

287 
	glog_´
[
t
] = 
log_wÜd_couÁ
 + 
f
[
k
];

290 
	glog_´
[
bËs
] = 
log
(
®pha
è+ 
f
[
tİics
];

292 
	g§m¶e_bË
 = 
Uts
::
Sam¶eFromLogPr
(
log_´
);

295 ià(
	g§m¶e_bË
 =ğ
bËs
) {

297 
docum’t
->
addNewTabË
();

298 
TabË
* 
	gÃw_bË
 = 
docum’t
->
g‘MubËTabË
(
§m¶e_bË
);

299 
	gwÜd
->
£tTabË
(
Ãw_bË
);

301 
	g§m¶e_tİic
 = 
Uts
::
Sam¶eFromLogPr
(
log_´_tİic
);

302 ià(
	g§m¶e_tİic
 =ğ
tİics
) {

304 
®l_tİics
.
addNewTİic
(
cÜpus_wÜd_no
);

308 
Tİic
* 
	gÃw_tİic
 = 
®l_tİics
.
g‘MubËTİic
(
§m¶e_tİic
);

309 
	gÃw_bË
->
£tTİic
(
Ãw_tİic
);

313 
TabË
* 
	gÃw_bË
 = 
docum’t
->
g‘MubËTabË
(
§m¶e_bË
);

314 
	gwÜd
->
£tTabË
(
Ãw_bË
);

318 
	gWÜdUts
::
Upd©eTabËFromWÜd
(
wÜd
, 1);

321 
	gDocum’tUts
::
Sam¶eTİics
(
Docum’t
* 
docum’t
, 
gamma
) {

322 
	gbËs
 = 
docum’t
->
g‘TabËs
();

323 
	gi
 = 0; i < 
	gbËs
; i++) {

324 
TabË
* 
	gbË
 = 
docum’t
->
g‘MubËTabË
(
i
);

325 
	gTabËUts
::
Sam¶eTİicFÜTabË
(
bË
, 
gamma
);

329 
	gDocum’tUts
::
P”mu‹WÜds
(
Docum’t
* 
docum’t
) {

330 
size
 = 
docum’t
->
g‘WÜds
();

331 
	gveùÜ
<
	gWÜd
> 
	g³rmu‹d_wÜds
;

336 
g¦_³rmutiÚ
* 
	g³rm
 = 
g¦_³rmutiÚ_ÿÎoc
(
size
);

337 
	gUts
::
Shufæe
(
³rm
, 
size
);

338 
	g³rm_size
 = 
³rm
->
size
;

339 
as£¹
(
size
 =ğ
³rm_size
);

341 
	gi
 = 0; i < 
	g³rm_size
; i++) {

342 
	g³rmu‹d_wÜds
.
push_back
(*
docum’t
->
g‘MubËWÜd
(
³rm
->
d©a
[
i
]));

345 
	gdocum’t
->
£tWÜds
(
³rmu‹d_wÜds
);

347 
g¦_³rmutiÚ_ä“
(
³rm
);

	@document.h

1 #iâdeà
DOCUMENT_H_


2 
	#DOCUMENT_H_


	)

4 
	~<veùÜ
>

5 
	~<unÜd”ed_m­
>

9 
usšg
 
Çme¥aû
 
	g¡d
;

11 
Çme¥aû
 
	ghdp
 {

13 
şass
 
	gTabË
;

14 
şass
 
	gTİic
;

17 şas 
	cWÜd
 {

18 
	gpublic
:

19 
WÜd
(
id
);

20 ~
WÜd
();

22 
g‘Id
(ècÚ¡ {  
	gid_
; }

23 
£tId
(cÚ¡ & 
id
è{ 
	gid_
 = id; }

25 
TabË
* 
g‘MubËTabË
(è{  
	gbË_
; }

26 
£tTabË
(
TabË
* 
bË
è{ 
	gbË_
 =able; }

28 
	g´iv©e
:

30 
id_
;

33 
TabË
* 
	gbË_
;

39 şas 
	cWÜdUts
 {

40 
	gpublic
:

43 
Upd©eTabËFromWÜd
(
WÜd
* 
wÜd
, 
upd©e
);

49 şas 
	cTabË
 {

50 
	gpublic
:

51 
TabË
();

52 
TabË
(
wÜd_couÁ
);

54 
g‘WÜdCouÁ
(ècÚ¡ {  
	gwÜd_couÁ_
; }

55 
£tWÜdCouÁ
(cÚ¡ & 
wÜd_couÁ
è{ 
	gwÜd_couÁ_
 = word_count; }

56 
šcWÜdCouÁ
(
v®
è{ 
	gwÜd_couÁ_
 += val; }

58 
Tİic
* 
g‘MubËTİic
(è{  
	gtİic_
; }

59 
£tTİic
(
Tİic
* 
tİic
è{ 
	gtİic_
 =opic; }

61 
g‘CouÁById
(
wÜd_id
);

62 
upd©eM­WÜdCouÁ
(
wÜd_id
, 
upd©e
);

64 
	gunÜd”ed_m­
<, >& 
g‘M­WÜdCouÁ
(è{  
	gm­_wÜd_couÁ_
; }

66 
	g´iv©e
:

68 
wÜd_couÁ_
;

71 
	gunÜd”ed_m­
<, > 
	gm­_wÜd_couÁ_
;

74 
Tİic
* 
	gtİic_
;

79 şas 
	cTabËUts
 {

80 
	gpublic
:

82 
G‘WÜdsAndCouÁs
(
TabË
* 
bË
,

83 
veùÜ
<>& 
wÜd_ids
,

84 
veùÜ
<>& 
couÁs
);

88 
Upd©eTİicFromTabË
(
TabË
* 
bË
,

89 
wÜd_id
,

90 
upd©e
);

97 
Upd©eTİicFromTabË
(
TabË
* 
bË
,

98 
veùÜ
<>& 
wÜd_ids
,

99 
veùÜ
<>& 
couÁs
,

100 
upd©e
);

103 
Sam¶eTİicFÜTabË
(
TabË
* 
bË
, 
gamma
);

108 şas 
	cDocum’t
 {

109 
	gpublic
:

110 
Docum’t
(
id
);

111 ~
Docum’t
();

113 
g‘WÜds
(è{  
	gwÜds_
.
size
(); }

114 
g‘TabËs
(è{  
	gbËs_
.
size
(); }

116 
addWÜd
(
id
è{ 
	gwÜds_
.
push_back
(
WÜd
(id)); }

117 
addWÜd
(cÚ¡ 
WÜd
& 
wÜd
è{ 
	gwÜds_
.
push_back
(word); }

118 
WÜd
* 
g‘MubËWÜd
(
i
è{  &(
	gwÜds_
[i]); }

119 
£tWÜds
(cÚ¡ 
veùÜ
<
WÜd
>& 
wÜds
) {

120 
	gwÜds_
 = 
wÜds
;

123 
addNewTabË
() {

124 
TabË
* 
	gÃw_bË
 = 
Ãw
 Table(0);

125 
	gbËs_
.
push_back
(
Ãw_bË
);

127 
»moveTabË
(
pos
);

129 
TabË
* 
g‘MubËTabË
(
i
è{  
	gbËs_
[i]; }

131 
g‘Id
(ècÚ¡ {  
	gid_
; }

132 
£tId
(cÚ¡ 
id
è{ 
	gid_
 = id; }

135 
	g´iv©e
:

137 
id_
;

140 
	gveùÜ
<
	gWÜd
> 
	gwÜds_
;

143 
	gveùÜ
<
	gTabË
*> 
	gbËs_
;

148 şas 
	cDocum’tUts
 {

149 
	gpublic
:

154 
Sam¶eTabËs
(
Docum’t
* 
docum’t
,

155 
³rmu‹_wÜds
,

156 
boŞ
 
»move
,

157 
®pha
,

158 
gamma
);

164 
Sam¶eTabËFÜWÜd
(
Docum’t
* 
docum’t
,

165 
WÜd
* 
wÜd
,

166 
boŞ
 
»move
,

167 
®pha
,

168 
gamma
,

169 
cÜpus_wÜd_no
);

172 
Sam¶eTİics
(
Docum’t
* 
docum’t
);

175 
Com·ùTabËs
(
Docum’t
* 
docum’t
);

178 
AÍhaScÜe
(
Docum’t
* 
docum’t
,

179 
®pha
);

182 
P”mu‹WÜds
(
Docum’t
* 
docum’t
);

185 
Sam¶eTİics
(
Docum’t
* 
docum’t
, 
gamma
);

	@gibbs.cc

3 
	~<as£¹.h
>

4 
	~<f¡»am
>

5 
	~<io¡»am
>

6 
	~<s¡»am
>

8 
	~"gibbs.h
"

9 
	~"docum’t.h
"

11 
	#REP_NO
 100

	)

12 
	#DEFAULT_HYPER_LAG
 0

	)

13 
	#DEFAULT_SHUFFLE_LAG
 100

	)

14 
	#DEFAULT_SAMPLE_GAMMA
 0

	)

15 
	#DEFAULT_SAMPLE_ETA
 0

	)

16 
	#DEFUALT_SAMPLE_ALPHA
 0

	)

17 
	#BUF_SIZE
 100

	)

19 
Çme¥aû
 
	ghdp
 {

25 
	gGibbsS‹
::
GibbsS‹
()

26 : 
scÜe_
(0.0),

27 
®pha_scÜe_
(0.0),

28 
‘a_scÜe_
(0.0),

29 
gamma_scÜe_
(0.0),

30 
max_scÜe_
(0.0),

31 
™”©iÚ_
(0),

32 
shufæe_Ïg_
(
DEFAULT_SHUFFLE_LAG
),

33 
hy³r_Ïg_
(
DEFAULT_HYPER_LAG
),

34 
§m¶e_‘a_
(
DEFAULT_SAMPLE_ETA
),

35 
§m¶e_®pha_
(
DEFUALT_SAMPLE_ALPHA
),

36 
§m¶e_gamma_
(
DEFAULT_SAMPLE_GAMMA
) {

41 
	gGibbsS‹
::
compu‹GibbsScÜe
() {

43 
®pha_scÜe_
 = 
CÜpusUts
::
AÍhaScÜe
(&
cÜpus_
);

44 
	g‘a_scÜe_
 = 
AÎTİicsUts
::
EScÜe
();

45 
	ggamma_scÜe_
 = 
AÎTİicsUts
::
GammaScÜe
(
cÜpus_
.
g‘Gamma
());

46 
	gscÜe_
 = 
®pha_scÜe_
 + 
‘a_scÜe_
 + 
gamma_scÜe_
;

47 
	gcout
 << "AÍha_scÜe: " << 
	g®pha_scÜe_
 << 
	g’dl
;

48 
	gcout
 << "E_scÜe: " << 
	g‘a_scÜe_
 << 
	g’dl
;

49 
	gcout
 << "Gamma_scÜe: " << 
	ggamma_scÜe_
 << 
	g’dl
;

50 
	gcout
 << "ScÜe: " << 
	gscÜe_
 << 
	g’dl
;

53 ià(
	gscÜe_
 > 
	gmax_scÜe_
 || 
	g™”©iÚ_
 == 0) {

54 
max_scÜe_
 = 
scÜe_
;

57  
	gscÜe_
;

64 
	gGibbsSam¶”
::
R—dGibbsIÅut
(

65 
GibbsS‹
* 
gibbs_¡©e
,

66 cÚ¡ 
¡d
::
¡ršg
& 
f’ame_cÜpus
,

67 cÚ¡ 
¡d
::
¡ršg
& 
f’ame_£‰šgs
) {

69 
if¡»am
 
šfe
(
f’ame_£‰šgs
.
c_¡r
());

70 
	gbuf
[
BUF_SIZE
];

72 
	g§m¶e_‘a
 = 
DEFAULT_SAMPLE_ETA
,

73 
	g§m¶e_®pha
 = 
DEFUALT_SAMPLE_ALPHA
,

74 
	g§m¶e_gamma
 = 
DEFAULT_SAMPLE_GAMMA
;

76 
	g®pha
, 
	ggamma
, 
	g‘a
;

78 
	gšfe
.
g‘lše
(
buf
, 
BUF_SIZE
)) {

79 
i¡ršg¡»am
 
s_lše
(
buf
);

81 
	g¡d
::
¡ršg
 
¡r
;

82 
g‘lše
(
s_lše
, 
¡r
, ' ');

83 
	g¡d
::
¡ršg
 
v®ue
;

84 
g‘lše
(
s_lše
, 
v®ue
, ' ');

85 ià(
	g¡r
.
com·»
("ETA") == 0) {

86 
‘a
ğ
©of
(
v®ue
.
c_¡r
());

87 } ià(
	g¡r
.
com·»
("ALPHA") == 0) {

88 
®pha
 = 
©of
(
v®ue
.
c_¡r
());

89 } ià(
	g¡r
.
com·»
("GAMMA") == 0) {

90 
gamma
 = 
©of
(
v®ue
.
c_¡r
());

91 } ià(
	g¡r
.
com·»
("SAMPLE_ALPHA") == 0) {

92 
§m¶e_®pha
 = 
©oi
(
v®ue
.
c_¡r
());

93 } ià(
	g¡r
.
com·»
("SAMPLE_ETA") == 0) {

94 
§m¶e_‘a
 = 
©oi
(
v®ue
.
c_¡r
());

95 } ià(
	g¡r
.
com·»
("SAMPLE_GAMMA") == 0) {

96 
§m¶e_gamma
 = 
©oi
(
v®ue
.
c_¡r
());

100 
	gšfe
.
şo£
();

103 
CÜpus
 
cÜpus
(
gamma
, 
®pha
);

104 
	gCÜpusUts
::
R—dCÜpus
(
f’ame_cÜpus
, &
cÜpus
);

106 
	ggibbs_¡©e
->
£tSam¶eE
(
§m¶e_‘a
);

107 
	ggibbs_¡©e
->
£tSam¶eAÍha
(
§m¶e_®pha
);

108 
	ggibbs_¡©e
->
£tSam¶eGamma
(
§m¶e_gamma
);

109 
	ggibbs_¡©e
->
£tCÜpus
(
cÜpus
);

111 
	gAÎTİics
::
G‘In¡ªû
().
£tE
(
‘a
);

115 
	gGibbsSam¶”
::
In™GibbsS‹
(

116 
GibbsS‹
* 
gibbs_¡©e
) {

118 
CÜpus
* 
cÜpus
 = 
gibbs_¡©e
->
g‘MubËCÜpus
();

120 
	g®pha
 = 
cÜpus
->
g‘AÍha
();

121 
	ggamma
 = 
cÜpus
->
g‘Gamma
();

124 
	gCÜpusUts
::
P”mu‹Docum’ts
(
cÜpus
);

126 
	gi
 = 0; i < 
	gcÜpus
->
g‘Docum’ts
(); i++) {

127 
Docum’t
* 
	gdocum’t
 = 
cÜpus
->
g‘MubËDocum’t
(
i
);

130 
	gDocum’tUts
::
Sam¶eTabËs
(
docum’t
, 1,

131 
çl£
, 
®pha
, 
gamma
);

132 
	gDocum’tUts
::
Com·ùTabËs
(
docum’t
);

134 
	gDocum’tUts
::
Sam¶eTİics
(
docum’t
, 
gamma
);

136 
	gAÎTİics
::
G‘In¡ªû
().
com·ùTİics
();

141 
	ggibbs_scÜe
 = 
gibbs_¡©e
->
compu‹GibbsScÜe
();

143 
	gcout
 << "Gibb scÜğ" << 
	ggibbs_scÜe
 << 
	g’dl
;

146 
GibbsS‹
* 
	gGibbsSam¶”
::
In™GibbsS‹R•
(

147 cÚ¡ 
¡d
::
¡ršg
& 
f’ame_cÜpus
,

148 cÚ¡ 
¡d
::
¡ršg
& 
f’ame_£‰šgs
,

149 
¿ndom_£ed
) {

150 
	gbe¡_scÜe
 = 0.0;

151 
GibbsS‹
* 
	gbe¡_gibbs_¡©e
 = 
NULL
;

153 
	gi
 = 0; i < 
	gREP_NO
; i++) {

155 
	gUts
::
In™RªdomNumb”G’
(
¿ndom_£ed
);

157 
GibbsS‹
* 
	ggibbs_¡©e
 = 
Ãw
 GibbsState();

158 
R—dGibbsIÅut
(
gibbs_¡©e
, 
f’ame_cÜpus
, 
f’ame_£‰šgs
);

161 
In™GibbsS‹
(
gibbs_¡©e
);

164 ià(
	ggibbs_¡©e
->
g‘ScÜe
(è> 
	gbe¡_scÜe
 || 
	gi
 == 0) {

165 ià(
be¡_gibbs_¡©e
 !ğ
NULL
) {

166 
d–‘e
 
be¡_gibbs_¡©e
;

168 
	gbe¡_gibbs_¡©e
 = 
gibbs_¡©e
;

169 
	gbe¡_scÜe
 = 
gibbs_¡©e
->
g‘ScÜe
();

170 
	gcout
 << "Best initial state‡t iteration: " <<

171 
	gi
 << " scÜ" << 
	gbe¡_scÜe
 << 
	g’dl
;

173 
d–‘e
 
	ggibbs_¡©e
;

177  
	gbe¡_gibbs_¡©e
;

180 
	gGibbsSam¶”
::
I‹¿‹GibbsS‹
(
GibbsS‹
* 
gibbs_¡©e
) {

181 
as£¹
(
gibbs_¡©e
 !ğ
NULL
);

183 
CÜpus
* 
	gcÜpus
 = 
gibbs_¡©e
->
g‘MubËCÜpus
();

184 
	ggibbs_¡©e
->
šcI‹¿tiÚ
(1);

185 
	gcu¼’t_™”©iÚ
 = 
gibbs_¡©e
->
g‘I‹¿tiÚ
();

187 
	gcout
 << "S¹ i‹¿tiÚ..." << 
	ggibbs_¡©e
->
g‘I‹¿tiÚ
(è<< 
	g’dl
;

190 
	g³rmu‹
 = 0;

191 
	gshufæe_Ïg
 = 
gibbs_¡©e
->
g‘ShufæeLag
();

192 ià(
	gshufæe_Ïg
 > 0) {

193 
	g³rmu‹
 = 1 - (
cu¼’t_™”©iÚ
 % 
shufæe_Ïg
);

197 ià(
	g³rmu‹
 == 1) {

198 
CÜpusUts
::
P”mu‹Docum’ts
(
cÜpus
);

201 
	g®pha
 = 
cÜpus
->
g‘AÍha
();

202 
	ggamma
 = 
cÜpus
->
g‘Gamma
();

205 
	gi
 = 0; i < 
	gcÜpus
->
g‘Docum’ts
(); i++) {

206 
Docum’t
* 
	gdocum’t
 = 
cÜpus
->
g‘MubËDocum’t
(
i
);

208 
	gDocum’tUts
::
Sam¶eTabËs
(
docum’t
, 
³rmu‹
,

209 
Œue
, 
®pha
, 
gamma
);

210 
	gDocum’tUts
::
Com·ùTabËs
(
docum’t
);

212 
	gDocum’tUts
::
Sam¶eTİics
(
docum’t
, 
gamma
);

214 
	gAÎTİics
::
G‘In¡ªû
().
com·ùTİics
();

218 ià(
	ggibbs_¡©e
->
g‘Hy³rLag
() > 0 &&

219 (
	gcu¼’t_™”©iÚ
 % 
	ggibbs_¡©e
->
g‘Hy³rLag
() == 0)) {

220 ià(
gibbs_¡©e
->
g‘Sam¶eE
() == 1) {

223 ià(
gibbs_¡©e
->
g‘Sam¶eAÍha
() == 1) {

226 ià(
gibbs_¡©e
->
g‘Sam¶eGamma
() == 1) {

233 
	ggibbs_scÜe
 = 
gibbs_¡©e
->
compu‹GibbsScÜe
();

235 
	gcout
 << "Gibbs score‡t iteration "

236 << 
	ggibbs_¡©e
->
g‘I‹¿tiÚ
(è<< " = " << 
	ggibbs_scÜe
 << 
	g’dl
;

	@gibbs.h

1 #iâdeà
GIBBS_H_


2 
	#GIBBS_H_


	)

4 
	~<¡ršg
>

6 
	~"cÜpus.h
"

7 
	~"tİic.h
"

8 
	~"uts.h
"

10 
Çme¥aû
 
	ghdp
 {

16 şas 
	cGibbsS‹
 {

17 
	gpublic
:

18 
GibbsS‹
();

26 
compu‹GibbsScÜe
();

28 
£tScÜe
(
scÜe
è{ 
	gscÜe_
 = score; }

29 
g‘ScÜe
(ècÚ¡ {  
	gscÜe_
; }

31 
£tAÍhaScÜe
(
®pha_scÜe
è{ 
	g®pha_scÜe_
 =‡lpha_score; }

32 
g‘AÍhaScÜe
(ècÚ¡ {  
	g®pha_scÜe_
; }

34 
£tEScÜe
(
‘a_scÜe
è{ 
	g‘a_scÜe_
 =ƒta_score; }

35 
g‘EScÜe
(ècÚ¡ {  
	g‘a_scÜe_
; }

37 
£tGammaScÜe
(
gamma_scÜe
è{ 
	ggamma_scÜe_
 = gamma_score; }

38 
g‘GammaScÜe
(ècÚ¡ {  
	ggamma_scÜe_
; }

40 
g‘MaxScÜe
(ècÚ¡ {  
	gmax_scÜe_
; }

41 
£tMaxScÜe
(
max_scÜe
è{ 
	gmax_scÜe_
 = max_score; }

43 
£tSam¶eE
(
§m¶e_‘a
è{ 
	g§m¶e_‘a_
 = sample_eta; }

44 
£tSam¶eAÍha
(
§m¶e_®pha
è{ 
	g§m¶e_®pha_
 = sample_alpha; }

45 
£tSam¶eGamma
(
§m¶e_gamma
è{ 
	g§m¶e_gamma_
 = sample_gamma; }

47 
£tCÜpus
(cÚ¡ 
CÜpus
& 
cÜpus
è{ 
	gcÜpus_
 = corpus; }

48 
CÜpus
* 
g‘MubËCÜpus
(è{  &
	gcÜpus_
; }

50 
g‘I‹¿tiÚ
(ècÚ¡ {  
	g™”©iÚ_
; }

51 
£tI‹¿tiÚ
(
™”©iÚ
è{ 
	g™”©iÚ_
 = iteration; }

52 
šcI‹¿tiÚ
(
v®
è{ 
	g™”©iÚ_
 += val; }

54 
g‘ShufæeLag
(ècÚ¡ {  
	gshufæe_Ïg_
; }

55 
g‘Hy³rLag
(ècÚ¡ {  
	ghy³r_Ïg_
; }

56 
g‘Sam¶eE
(ècÚ¡ {  
	g§m¶e_‘a_
; }

57 
g‘Sam¶eAÍha
(ècÚ¡ {  
	g§m¶e_®pha_
; }

58 
g‘Sam¶eGamma
(ècÚ¡ {  
	g§m¶e_gamma_
; }

60 
	g´iv©e
:

61 
CÜpus
 
cÜpus_
;

65 
	gscÜe_
;

68 
	g®pha_scÜe_
;

71 
	g‘a_scÜe_
;

74 
	ggamma_scÜe_
;

77 
	gmax_scÜe_
;

80 
	g™”©iÚ_
;

83 
	gshufæe_Ïg_
;

84 
	ghy³r_Ïg_
;

85 
	g§m¶e_‘a_
;

86 
	g§m¶e_®pha_
;

87 
	g§m¶e_gamma_
;

93 şas 
	cGibbsSam¶”
 {

94 
	gpublic
:

96 
R—dGibbsIÅut
(

97 
GibbsS‹
* 
gibbs_¡©e
,

98 cÚ¡ 
¡d
::
¡ršg
& 
f’ame_cÜpus
,

99 cÚ¡ 
¡d
::
¡ršg
& 
f’ame_£‰šgs
);

102 
In™GibbsS‹
(

103 
GibbsS‹
* 
gibbs_¡©e
);

109 
GibbsS‹
* 
In™GibbsS‹R•
(

110 cÚ¡ 
¡d
::
¡ršg
& 
f’ame_cÜpus
,

111 cÚ¡ 
¡d
::
¡ršg
& 
f’ame_£‰šgs
,

112 
ºg_£ed
);

117 
I‹¿‹GibbsS‹
(
GibbsS‹
* 
gibbs_¡©e
);

	@hdp_main.cc

2 
	~<io¡»am
>

4 
	~"gibbs.h
"

6 
usšg
 
	ghdp
::
GibbsSam¶”
;

7 
usšg
 
	ghdp
::
GibbsS‹
;

9 
	#MAX_ITERATIONS
 10000

	)

11 
	$maš
(
¬gc
, ** 
¬gv
) {

12 ià(
¬gc
 == 3) {

15 
ºg_£ed
;

16 (è
	`time
(&
ºg_£ed
);

18 
¡d
::
¡ršg
 
f’ame_cÜpus
 = 
¬gv
[1];

19 
¡d
::
¡ršg
 
f’ame_£‰šgs
 = 
¬gv
[2];

20 
hdp
::
GibbsS‹
* 
gibbs_¡©e
 = hdp::
GibbsSam¶”
::
	`In™GibbsS‹R•
(

21 
f’ame_cÜpus
, 
f’ame_£‰šgs
, 
ºg_£ed
);

23 
i
 = 0; i < 
MAX_ITERATIONS
; i++) {

24 
hdp
::
GibbsSam¶”
::
	`I‹¿‹GibbsS‹
(
gibbs_¡©e
);

27 
d–‘e
 
gibbs_¡©e
;

29 
cout
 << "Arguments: "

31 "(2è£‰šg f’ame" << 
’dl
;

34 
	}
}

	@test.cc

1 
	~<io¡»am
>

2 
	~<m©h.h
>

4 
	~"uts.h
"

6 
usšg
 
Çme¥aû
 
	g¡d
;

8 
	$maš
() {

9 
veùÜ
<> 
log_´
;

10 
log_´
.
	`push_back
(
	`log
(1));

11 
log_´
.
	`push_back
(
	`log
(0));

14 
¿nd_£ed
 = 1234l;

15 
hdp
::
Uts
::
	`In™RªdomNumb”G’
(
¿nd_£ed
);

22 
cout
 << 
hdp
::
Uts
::
	`LogSum
(
	`log
(0),†og(2)è<< 
’dl
;

23 
cout
 << 
	`log
(2è<< 
’dl
;

25 
cout
 << 1 / (1 * 2.0è<< 
’dl
;

26 
cout
 << 
	`exp
(
	`log
(0è* 2è<< 
’dl
;

29 
	}
}

	@topic.cc

1 
	~<m©h.h
>

2 
	~<as£¹.h
>

4 
	~"uts.h
"

5 
	~"tİic.h
"

7 
Çme¥aû
 
	ghdp
 {

12 
	gTİic
::
Tİic
(
cÜpus_wÜd_no
)

13 : 
cÜpus_wÜd_no_
(
cÜpus_wÜd_no
),

14 
bË_couÁ_
(0),

15 
wÜd_couÁs_
(
cÜpus_wÜd_no
, 0) {

16 
	gAÎTİics
& 
	g®l_tİics
 = 
AÎTİics
::
G‘In¡ªû
();

17 
	g‘a
 = 
®l_tİics
.
g‘E
();

18 
	glgam_w_‘a
 = 
g¦_sf_Êgamma
(
‘a
);

20 
	gwÜd_couÁs_
 = 
veùÜ
<>(
cÜpus_wÜd_no
, 0);

21 
	glgam_wÜd_‘a_
 = 
veùÜ
<>(
cÜpus_wÜd_no
, 
	glgam_w_‘a
);

23 
	glog_w_´
 = 
log
(1.0 / 
cÜpus_wÜd_no
);

24 
	glog_wÜd_´_
 = 
veùÜ
<>(
cÜpus_wÜd_no
, 
	glog_w_´
);

28 
	gTİic
::
upd©eWÜdCouÁs
(
wÜd_id
, 
upd©e
) {

29 
	gwÜd_couÁs_
[
wÜd_id
] +ğ
upd©e
;

31 
	g‘a
 = 
AÎTİics
::
G‘In¡ªû
().
g‘E
();

32 
	gwÜd_couÁ
 = 
wÜd_couÁs_
[
wÜd_id
];

34 
	glgam_wÜd_‘a_
[
wÜd_id
] = 
g¦_sf_Êgamma
(
wÜd_couÁ
 + 
‘a
);

35 
	glog_wÜd_´_
[
wÜd_id
] = 
log
(
wÜd_couÁ
è-log(wÜd_couÁ + 
‘a
 * 
cÜpus_wÜd_no_
 );

38 
	gTİic
::
g‘TİicWÜds
() const {

39 
sum
 = 0;

40 autØ
	gcouÁ
 : 
wÜd_couÁs_
) {

41 
sum
 +ğ
couÁ
;

44  
	gsum
;

50 
	gAÎTİics
::~
AÎTİics
() {

51 
size
 = 
tİic_±rs_
.size();

52 
	gi
 = 0; i < 
	gsize
; i++) {

53 ià(
	gtİic_±rs_
[
i
] !ğ
NULL
) {

54 
d–‘e
 
tİic_±rs_
[
i
];

59 
	gAÎTİics
& AÎTİics::
G‘In¡ªû
() {

60 
AÎTİics
 
š¡ªû
;

61  
	gš¡ªû
;

64 
	gAÎTİics
::
addNewTİic
(
cÜpus_wÜd_no
) {

65 
Tİic
* 
tİic
 = 
Ãw
 Tİic(
cÜpus_wÜd_no
);

66 
	gtİic_±rs_
.
push_back
(
tİic
);

69 
	gAÎTİics
::
»moveTİic
(
Tİic
* 
tİic
) {

70 
»moveFromVec
(
tİic_±rs_
, 
tİic
);

73 
	gAÎTİics
::
»moveTİic
(
pos
) {

74 autØ
™
 = 
tİic_±rs_
.
begš
(è+ 
pos
;

75 
Tİic
* 
	gtİic
 = *
™
;

76 
as£¹
(
tİic
->
g‘TabËCouÁ
() == 0);

78 
d–‘e
 *
	g™
;

79 
	gtİic
 = 
NULL
;

80 *
	g™
 = 
NULL
;

81 
	gtİic_±rs_
.
”a£
(
™
);

85 
	gAÎTİics
::
»moveLa¡Tİic
() {

86 
size
 = 
tİic_±rs_
.size();

87 
d–‘e
 
	gtİic_±rs_
[
size
];

88 
	gtİic_±rs_
[
size
] = 
NULL
;

89 
	gtİic_±rs_
.
»size
(
size
 - 1);

92 
	gAÎTİics
::
com·ùTİics
() {

93 
size
 = 
tİic_±rs_
.size();

94 
	gi
 = 
size
 - 1; i >=0; --i) {

95 ià(
	gtİic_±rs_
[
i
]->
g‘TabËCouÁ
() == 0) {

96 
»moveTİic
(
i
);

105 
	gTİicUts
::
EScÜe
(
Tİic
* 
tİic
, 
‘a
) {

106 
	gscÜe
 = 0.0;

107 
	glgam_‘a
 = 
g¦_sf_Êgamma
(
‘a
);

108 
	gcÜpus_wÜd_no
 = 
tİic
->
g‘CÜpusWÜdNo
();

109 
	gtİic_wÜds
 = 0;

111 
	gscÜe
 +ğ
g¦_sf_Êgamma
(
cÜpus_wÜd_no
 * 
‘a
);

112 
	gi
 = 0; i < 
	gcÜpus_wÜd_no
; i++) {

113 
	gwÜd_couÁ
 = 
tİic
->
g‘WÜdCouÁ
(
i
);

114 ià(
	gwÜd_couÁ
 > 0) {

115 
	gtİic_wÜds
 +ğ
wÜd_couÁ
;

116 
	gscÜe
 +ğ
g¦_sf_Êgamma
(
wÜd_couÁ
 + 
‘a
è- 
lgam_‘a
;

119 
	gscÜe
 -ğ
g¦_sf_Êgamma
(
cÜpus_wÜd_no
 * 
‘a
 + 
tİic_wÜds
);

121  
	gscÜe
;

128 
	gTİicTabËUts
::
LogGammaR©io
(
TabË
* 
bË
,

129 
Tİic
* 
tİic
,

130 
veùÜ
<>& 
wÜd_ids
,

131 
veùÜ
<>& 
couÁs
) {

132 
	glog_gamma_¿tio
 = 0.0;

133 
Tİic
* 
	gŞd_tİic
 = 
bË
->
g‘MubËTİic
();

135 
	g‘a
 = 
AÎTİics
::
G‘In¡ªû
().
g‘E
();

136 
	gtİic_wÜds
 = 
tİic
->
g‘TİicWÜds
();

137 
	gbË_wÜds
 = 
bË
->
g‘WÜdCouÁ
();

138 
	gcÜpus_wÜd_no
 = 
tİic
->
g‘CÜpusWÜdNo
();

142 ià(
	gŞd_tİic
 =ğ
tİic
) {

143 
log_gamma_¿tio
 +ğ
g¦_sf_Êgamma
(
cÜpus_wÜd_no
 * 
‘a
 + 
tİic_wÜds
 - 
bË_wÜds
) -

144 
g¦_sf_Êgamma
(
cÜpus_wÜd_no
 * 
‘a
 + 
tİic_wÜds
);

146 
	gi
 = 0; i < ()
	gwÜd_ids
.
size
(); i++) {

147 
	gwÜd_id
 = 
wÜd_ids
[
i
];

148 
	gwÜd_couÁ
 = 
tİic
->
g‘WÜdCouÁ
(
wÜd_id
);

149 
	glog_gamma_¿tio
 +ğ
tİic
->
g‘LgamWÜdE
(
wÜd_id
) -

150 
g¦_sf_Êgamma
(
wÜd_couÁ
 + 
‘a
 - 
couÁs
[
i
]);

153 
	glog_gamma_¿tio
 +ğ
g¦_sf_Êgamma
(
cÜpus_wÜd_no
 * 
‘a
 + 
tİic_wÜds
) -

154 
g¦_sf_Êgamma
(
cÜpus_wÜd_no
 * 
‘a
 + 
tİic_wÜds
 + 
bË_wÜds
);

156 
	gi
 = 0; i < ()
	gwÜd_ids
.
size
(); i++) {

157 
	gwÜd_id
 = 
wÜd_ids
[
i
];

158 
	gwÜd_couÁ
 = 
tİic
->
g‘WÜdCouÁ
(
wÜd_id
);

159 
	glog_gamma_¿tio
 +ğ
g¦_sf_Êgamma
(
wÜd_couÁ
 + 
‘a
 + 
couÁs
[
i
]) -

160 
tİic
->
g‘LgamWÜdE
(
wÜd_id
);

164  
	glog_gamma_¿tio
;

172 
	gAÎTİicsUts
::
GammaScÜe
(
gamma
) {

173 
scÜe
 = 0.0;

174 
	gAÎTİics
& 
	g®l_tİics
 = 
AÎTİics
::
G‘In¡ªû
();

175 
	gtİics
 = 
®l_tİics
.
g‘Tİics
();

176 
	gbË_tÙ®
 = 0;

178 
	gi
 = 0; i < 
	gtİics
; i++) {

179 
Tİic
* 
	gtİic
 = 
®l_tİics
.
g‘MubËTİic
(
i
);

180 
	gbËs
 = 
tİic
->
g‘TabËCouÁ
();

181 
	gscÜe
 +ğ
g¦_sf_Êgamma
(
bËs
);

182 
	gbË_tÙ®
 +ğ
bËs
;

185 
	gscÜe
 +ğ
tİics
 * 
log
(
gamma
) +

186 
g¦_sf_Êgamma
(
gamma
) -

187 
g¦_sf_Êgamma
(
bË_tÙ®
 + 
gamma
);

189  
	gscÜe
;

192 
	gAÎTİicsUts
::
EScÜe
() {

193 
AÎTİics
& 
®l_tİics
 = AÎTİics::
G‘In¡ªû
();

194 
	gtİics
 = 
®l_tİics
.
g‘Tİics
();

195 
	g‘a
 = 
®l_tİics
.
g‘E
();

197 
	gscÜe
 = 0.0;

198 
	gi
 = 0; i < 
	gtİics
; i++) {

199 
Tİic
* 
	gtİic
 = 
®l_tİics
.
g‘MubËTİic
(
i
);

200 
	gscÜe
 +ğ
TİicUts
::
EScÜe
(
tİic
, 
‘a
);

203  
	gscÜe
;

	@topic.h

1 #iâdeà
TOPIC_H_


2 
	#TOPIC_H_


	)

4 
	~<veùÜ
>

5 
	~<g¦/g¦_sf.h
>

7 
	~"docum’t.h
"

9 
usšg
 
Çme¥aû
 
	g¡d
;

12 
Çme¥aû
 
	ghdp
 {

17 şas 
	cTİic
 {

18 
	gpublic
:

19 
Tİic
(
cÜpus_wÜd_no
);

21 
g‘CÜpusWÜdNo
(ècÚ¡ {  
	gcÜpus_wÜd_no_
; }

22 
£tCÜpusWÜdNO
(
cÜpus_wÜd_no
è{ 
	gcÜpus_wÜd_no_
 = corpus_word_no; }

24 
g‘TabËCouÁ
(ècÚ¡ {  
	gbË_couÁ_
; }

25 
£tTabËCouÁ
(
bË_couÁ
è{ 
	gbË_couÁ
 = 
bË_couÁ_
; }

26 
šcTabËCouÁ
(
v®
è{ 
	gbË_couÁ_
 += val; }

28 
upd©eWÜdCouÁs
(
wÜd_id
, 
upd©e
);

29 
g‘WÜdCouÁ
(
wÜd_id
ècÚ¡ {  
	gwÜd_couÁs_
[word_id]; }

31 
g‘LgamWÜdE
(
wÜd_id
ècÚ¡ {  
	glgam_wÜd_‘a_
[word_id]; }

32 
g‘LogWÜdPr
(
wÜd_id
ècÚ¡ {  
	glog_wÜd_´_
[word_id]; }

34 
g‘TİicWÜds
() const;

35 
	g´iv©e
:

37 
cÜpus_wÜd_no_
;

40 
	gbË_couÁ_
;

43 
	gveùÜ
<> 
	gwÜd_couÁs_
;

46 
	gveùÜ
<> 
	glgam_wÜd_‘a_
;

49 
	gveùÜ
<> 
	glog_wÜd_´_
;

55 şas 
	cTİicUts
 {

56 
	gpublic
:

58 
EScÜe
(
Tİic
* 
tİic
, 
‘a
);

65 şas 
	cAÎTİics
 {

66 
	gpublic
:

67 ~
AÎTİics
();

70 
	gAÎTİics
& 
G‘In¡ªû
();

72 
g‘Tİics
(ècÚ¡ {  
	gtİic_±rs_
.
size
(); }

74 
addNewTİic
(
cÜpus_wÜd_no
);

75 
»moveTİic
(
Tİic
* 
tİic
);

76 
»moveTİic
(
pos
);

77 
»moveLa¡Tİic
();

78 
com·ùTİics
();

80 
Tİic
* 
g‘MubËTİic
(
i
) {

81  
	gtİic_±rs_
[
i
];

84 
g‘E
(ècÚ¡ {  
	g‘a_
; }

85 
£tE
(cÚ¡ & 
‘a
è{ 
	g‘a_
 =ƒta; }

87 
	g´iv©e
:

89 
veùÜ
<
Tİic
*> 
tİic_±rs_
;

92 
	g‘a_
;

95 
AÎTİics
() { }

97 
AÎTİics
(cÚ¡ AÎTİics& 
äom
);

98 
	gAÎTİics
& 
	gİ”©Ü
=(cÚ¡ 
AÎTİics
& 
äom
);

103 şas 
	cTİicTabËUts
 {

104 
	gpublic
:

110 
LogGammaR©io
(
TabË
* 
bË
,

111 
Tİic
* 
tİic
,

112 
veùÜ
<>& 
wÜd_ids
,

113 
veùÜ
<>& 
couÁs
);

118 şas 
	cAÎTİicsUts
 {

119 
	gpublic
:

122 
GammaScÜe
(
gamma
);

126 
EScÜe
();

	@utils.cc

16 
	~<as£¹.h
>

17 
	~<m©h.h
>

18 
	~<time.h
>

19 
	~<g¦/g¦_sf.h
>

21 
	~<io¡»am
>

23 
	~"uts.h
"

25 
Çme¥aû
 
	ghdp
 {

31 
g¦_ºg
* 
	gUts
::
RANDNUMGEN
 = 
NULL
;

33 
	gUts
::
Sum
(cÚ¡ 
veùÜ
<>& 
v
) {

34 
sum
 = 0;

35 
	gsize
 = 
v
.
size
();

36 
	gi
 = 0; i < 
	gsize
; i++) {

37 
	gsum
 +ğ
v
[
i
];

39  
	gsum
;

42 
	gUts
::
LogSum
(
log_a
, 
log_b
) {

43 ià(
	glog_a
 < 
	glog_b
) {

44 (
	glog_b
 + 
log
(1 + 
exp
(
log_a
 - 
log_b
)));

46 (
	glog_a
 + 
log
(1 + 
exp
(
log_b
 - 
log_a
)));

50 
	gUts
::
Sam¶eFromLogPr
(cÚ¡ 
veùÜ
<>& 
log_´
) {

51 
as£¹
(
log_´
.
size
() > 0);

53 
	glog_sum
 = 
log_´
[0];

54 
	gËv–s
 = 
log_´
.
size
();

57 
	gi
 = 1; i < 
	gËv–s
; i++) {

58 
	glog_sum
 = 
LogSum
(
log_sum
, 
log_´
[
i
]);

62 
	g¿nd_no
 = 
RªdNo
();

64 
	glog_exp
 = 
exp
(
log_´
[0] - 
log_sum
);

65 
	g»suÉ
 = 0;

66 
	g¿nd_no
 >ğ
log_exp
) {

67 
»suÉ
++;

68 
	glog_exp
 +ğ
exp
(
log_´
[
»suÉ
] - 
log_sum
);

71  
	g»suÉ
;

74 
	gUts
::
In™RªdomNumb”G’
(
ºg_£ed
) {

75 ià(
RANDNUMGEN
 !ğ
NULL
) ;

77 
	gRANDNUMGEN
 = 
g¦_ºg_®loc
(
g¦_ºg_us
);

78 
	gcout
 << "Rªdom s“d = " << 
	gºg_£ed
 << 
	g’dl
;

79 
g¦_ºg_£t
(
RANDNUMGEN
, 
ºg_£ed
);

82 
	gUts
::
Shufæe
(
g¦_³rmutiÚ
* 
³rmutiÚ
, 
size
) {

83 
as£¹
(
RANDNUMGEN
 !ğ
NULL
);

84 
g¦_¿n_shufæe
(
RANDNUMGEN
, 
³rmutiÚ
->
d©a
, 
size
, (
size_t
));

87 
	gUts
::
RªdGauss
(
m—n
, 
¡dev
) {

88 
as£¹
(
RANDNUMGEN
 !ğ
NULL
);

89 
	ggauss
 = 
g¦_¿n_gaussŸn_¿tio_m‘hod
(
RANDNUMGEN
, 
¡dev
è+ 
	gm—n
;

90 (
	ggauss
);

93 
	gUts
::
RªdNo
() {

94 
as£¹
(
RANDNUMGEN
 !ğ
NULL
);

95  
g¦_ºg_unifÜm
(
RANDNUMGEN
);

	@utils.h

16 #iâdeà
UTILS_H_


17 
	#UTILS_H_


	)

19 
	~<g¦/g¦_³rmutiÚ.h
>

20 
	~<g¦/g¦_¿ndi¡.h
>

22 
	~<veùÜ
>

23 
	~<®gÜ™hm
>

25 
usšg
 
Çme¥aû
 
	g¡d
;

27 
Çme¥aû
 
	ghdp
 {

31 
	g‹m¶©e
<
ty³Çme
 
	gT
>

32 
»moveFromVec
(
veùÜ
<
T
>& 
v
, T 
rg‘
) {

33 autØ
	gfound
 = 
fšd
(
v
.
begš
(), v.
’d
(), 
rg‘
);

34 ià(
	gfound
 =ğ
v
.
’d
()) {

37 
v
.
”a£
(
found
);

41 
	g‹m¶©e
<
ty³Çme
 
	gT
>

42 
»moveFromVec
(
veùÜ
<
T
*>& 
v
, T* 
rg‘
) {

43 autØ
	gfound
 = 
fšd
(
v
.
begš
(), v.
’d
(), 
rg‘
);

44 ià(
	gfound
 =ğ
v
.
’d
()) {

48 ià(*
found
 !ğ
NULL
) {

49 
d–‘e
 *
found
;

50 *
	gfound
 = 
NULL
;

53 
	gv
.
”a£
(
found
);

61 şas 
	cUts
 {

62 
	gpublic
:

64 
Sum
(cÚ¡ 
veùÜ
<>& 
v
);

71 
LogSum
(
log_a
, 
log_b
);

79 
Sam¶eFromLogPr
(cÚ¡ 
veùÜ
<>& 
log_´
);

82 
Shufæe
(
g¦_³rmutiÚ
* 
³rmutiÚ
, 
size
);

86 
In™RªdomNumb”G’
(
ºg_£ed
);

89 
RªdGauss
(
m—n
, 
¡dev
);

92 
RªdNo
();

94 
	g´iv©e
:

95 
g¦_ºg
* 
RANDNUMGEN
;

	@
1
.
0
12
113
corpus.cc
corpus.h
document.cc
document.h
gibbs.cc
gibbs.h
hdp_main.cc
test.cc
topic.cc
topic.h
utils.cc
utils.h
